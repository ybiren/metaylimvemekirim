<div class="chat" dir="rtl">
  <!-- Header -->
  <header class="chat__header">
    <button type="button" class="chat__close" (click)="close()">✕</button>

    <div>
      <div class="chat__name">צ'אט עם {{ peerName }}</div>
      <div class="chat__status" [class.online]="isPeerOnline">
        {{ isPeerOnline ? 'מחובר/ת' : 'לא מחובר/ת' }}
      </div>
    </div>
  </header>

  <!-- Messages -->
  <main class="chat__scroll" #scrollArea>

    <div class="chat__empty" *ngIf="messages.length === 0">
      אין הודעות עדיין
    </div>

    <div
      *ngFor="let m of messages; trackBy: trackById"
      class="msg"
      [class.msg--me]="m.fromUserId === me"
      [class.msg--peer]="m.fromUserId !== me"
    >
      <span class="text">{{ m.content }}</span>

      <span class="meta">
        <span class="time">{{ m.sentAt | date:'HH:mm' }}</span>
        <span class="ticks"
              [class.delivered]="!!m.deliveredAt"
              [class.read]="!!m.readAt">✓✓</span>
      </span>
    </div>

    <div class="chat__typing" *ngIf="typing$ | async">מקליד/ה…</div>
  </main>

  <!-- Composer -->
  @if(!isLoggedIUserBlockedByPeer()?.is_blocked) {
  <footer class="chat__composer">
    <input
      #input
      class="chat__input"
      type="text"
      dir="rtl"
      placeholder="כתוב הודעה…"
      [(ngModel)]="draft"
      (keydown.enter)="send()"
      (input)="onTyping()"
    />

    <button type="button" class="chat__send" (click)="send()">
      שלח
    </button>
  </footer>
  }
</div>
