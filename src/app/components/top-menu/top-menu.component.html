<div class="top-shell" dir="rtl">
  <!-- Top bar: invite + logo + burger -->
  <div class="top-bar">
    <a routerLink="/home" class="logo-wrapper">
      <img src="assets/images/logo.jpg" alt="metaylimvemekirim" />
    </a>
    <button class="invite-btn" (click)="openReminder('1', 'aa')">
      הזמן חבר
    </button>
    <!-- Hamburger visible on mobile -->
    <button
      type="button"
      class="burger"
      (click)="toggleMenu()"
      aria-label="תפריט"
      [attr.aria-expanded]="isMenuOpen"
    >
      <span></span>
      <span></span>
      <span></span>
    </button>
  </div>

  <!-- Main menu -->
  <div class="top-menu">
    @if (loggedInUser) {
      <div class="greeting">
        <a [routerLink]="['/user', loggedInUser.id]">
          ({{ loggedInUser.name }})
        </a>
      </div>
    }
    <nav [class.open]="isMenuOpen">
      <a
        routerLink="/about-us"
        routerLinkActive="active"
        (click)="onNavLinkClick()"
        >אודותינו</a
      >

      <a
        routerLink="/contact"
        routerLinkActive="active"
        (click)="onNavLinkClick()"
        >צור קשר</a
      >
      
      <a
        routerLink="/sms"
        routerLinkActive="active"
        (click)="onNavLinkClick()"
        >sms</a
      >
 
      @if (!loggedInUser) {  
      <a
        routerLink="/"
        (click)="onNavLinkClick()"
        >התחברות לאתר</a
      >
      } 

      @if (loggedInUser) {
        
        <!-- Inbox dropdown -->
        <div class="inbox" [class.open]="open">
          <button
            type="button"
            class="inbox-btn"
            (click)="onInboxBtn($event)"
            aria-label="פתיחת הודעות"
            [attr.aria-expanded]="open"
            aria-haspopup="dialog"
          >
            <span class="icon">💬</span>
            <span class="label">ציאטים</span>
            <span class="badge" *ngIf="unreadTotal > 0">
              {{ unreadTotal }}
            </span>
          </button>

          <!-- Panel -->
          <div class="panel" *ngIf="open" (click)="$event.stopPropagation()">
            <header class="panel-head">
              <strong>הודעות</strong>
              <button
                type="button"
                class="close"
                (click)="open = false"
                aria-label="סגירה"
              >
                ✕
              </button>
              <span class="muted" *ngIf="threads.length === 0">
                אין הודעות
              </span>
            </header>
            <ul class="list">
              <li *ngFor="let t of threads" (click)="openChat(t.peerId, t.lastPreview, t.peerName)">
                <div class="row">
                  <div class="avatar">
                    <span>
                      <img [src]="imageUrl()(t.peerId)" alt="user photo" class="avatar" />
                    </span>
                  </div>
                  <div class="meta">
                    <div class="top">
                      <span class="name">{{ t.peerName }}</span>
                      <span *ngIf="isOnline(t.peerId)" class="online">כרגע באתר</span>
                      <span class="time">
                        <span class="preview">{{ t.lastPreview }}</span>
                      </span>
                    </div>
                    <div class="bottom">
                        {{ t.lastAt | date:'dd/MM/yyyy HH:mm' }}
                     <!--
                      <span class="unread" *ngIf="t.unread > 0">
                        {{ t.unread }}
                      </span>
                      -->
                    </div>
                  </div>
                </div>
              </li>
            </ul>
          </div>
        </div>
        <a
          routerLink="/register"
          routerLinkActive="active"
          (click)="onNavLinkClick()"
          >עדכון פרטים</a
        >

        <a
          routerLink="/search"
          [queryParams]="randomInit()"
          routerLinkActive="active"
          (click)="onNavLinkClick()"
          >חפש חברים</a
        >

        <a
          routerLink="/users"
          routerLinkActive="active"
          (click)="onNavLinkClick()"
          >כל החברים</a
        >
              
        <a
          routerLink="/album"
          routerLinkActive="active"
          (click)="onNavLinkClick()"
        >אלבומים</a
      >

      <a
          routerLink="/chat-system-rooms"
          routerLinkActive="active"
          (click)="onNavLinkClick();"
        >חדרי צ'אט</a
      >

      <a
          routerLink="/help"
          routerLinkActive="active"
          (click)="onNavLinkClick()"
        >עזרה</a
      >

      }
      
      <a *ngIf="loggedInUser" (click)="logout()" class="logout">יציאה</a>
    </nav>
  </div>
</div>
