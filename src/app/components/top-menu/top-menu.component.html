<div class="top-shell" dir="rtl">
  <!-- Top bar: invite + logo + burger -->
  <div class="top-bar">
    <a routerLink="/home" class="logo-wrapper">
      <img src="assets/images/logo.jpg" alt="metaylimvemekirim" />
    </a>
    <button class="invite-btn" (click)="openReminder('1', 'aa')">
      ×”×–××Ÿ ×—×‘×¨
    </button>
    <!-- Hamburger visible on mobile -->
    <button
      type="button"
      class="burger"
      (click)="toggleMenu()"
      aria-label="×ª×¤×¨×™×˜"
      [attr.aria-expanded]="isMenuOpen"
    >
      <span></span>
      <span></span>
      <span></span>
    </button>
  </div>

  <!-- Main menu -->
  <div class="top-menu">
    @if (loggedInUser) {
      <div class="greeting">
        <a [routerLink]="['/user', loggedInUser.userID]">
          ({{ loggedInUser.c_name }})
        </a>
      </div>
    }

    <nav [class.open]="isMenuOpen">
      <a
        routerLink="/about-us"
        routerLinkActive="active"
        (click)="onNavLinkClick()"
        >××•×“×•×ª×™× ×•</a
      >

      <a
        routerLink="/contact"
        routerLinkActive="active"
        (click)="onNavLinkClick()"
        >×¦×•×¨ ×§×©×¨</a
      >
      @if (loggedInUser) {
        
        <!-- Inbox dropdown -->
        <div class="inbox" [class.open]="open">
          <button
            type="button"
            class="inbox-btn"
            (click)="onInboxBtn($event)"
            aria-label="×¤×ª×™×—×ª ×”×•×“×¢×•×ª"
            [attr.aria-expanded]="open"
            aria-haspopup="dialog"
          >
            <span class="icon">ğŸ’¬</span>
            <span class="label">×”×•×“×¢×•×ª</span>
            <span class="badge" *ngIf="unreadTotal > 0">
              {{ unreadTotal }}
            </span>
          </button>

          <!-- Panel -->
          <div class="panel" *ngIf="open" (click)="$event.stopPropagation()">
            <header class="panel-head">
              <strong>×”×•×“×¢×•×ª</strong>
              <button
                type="button"
                class="close"
                (click)="open = false"
                aria-label="×¡×’×™×¨×”"
              >
                âœ•
              </button>
              <span class="muted" *ngIf="threads.length === 0">
                ××™×Ÿ ×”×•×“×¢×•×ª
              </span>
            </header>

            <ul class="list">
              <li *ngFor="let t of threads" (click)="openChat(t.peerId)">
                <div class="row">
                  <div class="avatar">
                    <span>
                      <img [src]="imageUrl()(t.peerId)" alt="user photo" class="avatar" />
                    </span>
                  </div>
                  <div class="meta">
                    <div class="top">
                      <span class="name">{{ nameFor(t.peerId) }}</span>
                      <span *ngIf="isOnline(t.peerId)" class="online">×›×¨×’×¢ ×‘××ª×¨</span>
                      <span class="time">
                        <span class="preview">{{ t.lastPreview }}</span>
                      </span>
                    </div>
                    <div class="bottom">
                        {{ t.lastAt | date:'dd/MM/yyyy HH:mm' }}
                     <!--
                      <span class="unread" *ngIf="t.unread > 0">
                        {{ t.unread }}
                      </span>
                      -->
                    </div>
                  </div>
                </div>
              </li>
            </ul>
          </div>
        </div>
        <a
          routerLink="/register"
          routerLinkActive="active"
          (click)="onNavLinkClick()"
          >×¢×“×›×•×Ÿ ×¤×¨×˜×™×</a
        >

        <a
          routerLink="/search"
          [queryParams]="randomInit()"
          routerLinkActive="active"
          (click)="onNavLinkClick()"
          >×—×¤×© ×—×‘×¨×™×</a
        >

        <a
          routerLink="/users"
          routerLinkActive="active"
          (click)="onNavLinkClick()"
          >×›×œ ×”×—×‘×¨×™×</a
        >
                
      }
      
      <a *ngIf="loggedInUser" (click)="logout()" class="logout">×™×¦×™××”</a>
    </nav>
  </div>
</div>
